<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Orchestral Instrument Families - Drag & Drop</title>

  <!-- Inline CSS: colors + fonts -->
  <style type="text/css">
    /* ===== Global ===== */
    html, body {
      margin: 0; padding: 0;
      background-color: #a3b899; /* page bg (soft sage) */
      font-family: "Garamond", Georgia, serif; /* classical serif */
      color: #333;
    }
    h1 {
      margin: 20px 10px 8px;
      text-align: center;
      color: #667b68;
    }
    p.instructions {
      text-align: center;
      margin: 0 10px 16px;
      color: #667b68;
    }
    .style1 { font-weight: bold; }

    /* ===== Outer container ===== */
    #dhtmlgoodies_dragDropContainer{
      width: 900px;
      margin: 0 auto 24px auto; /* centered */
      background-color: #fceee9; /* main container bg */
      border: 3px solid #667b68; /* forest green border */
      border-radius: 12px;
      padding: 12px;
      position: relative;
    }

    /* ===== Columns ===== */
    #dhtmlgoodies_listOfItems{
      float: left;
      width: 260px;
      margin-right: 12px;
    }
    #dhtmlgoodies_mainContainer{
      float: left;
      width: 600px; /* 4 boxes in a grid */
    }

    /* Clearfix */
    #dhtmlgoodies_dragDropContainer:after{
      content:""; display:block; clear:both;
    }

    /* ===== Left: items list ===== */
    #dhtmlgoodies_listOfItems p{
      margin: 0 0 8px 0;
      font-weight: bold;
      color: #667b68;
      background-color: #f8d3c5; /* headings bg */
      border-radius: 8px;
      padding: 6px 8px;
    }
    #allItems{
      list-style-type:none; margin:0; padding:0;
      min-height: 300px;
      background:#fff;
      border: 2px solid #667b68;
      border-radius: 10px;
      padding: 6px;
    }

    /* ===== Right: family boxes grid ===== */
    #dhtmlgoodies_mainContainer > div{
      width: 285px; /* two per row */
      margin: 0 12px 12px 0;
      float: left;
    }
    #dhtmlgoodies_mainContainer > div:nth-child(2n){
      margin-right: 0; /* align pairs */
    }
    #dhtmlgoodies_mainContainer div p{
      margin: 0 0 6px 0;
      background-color: #f8d3c5; /* headings bg */
      color: #667b68;
      border-radius: 8px;
      padding: 6px 8px;
      font-weight: bold;
    }
    #dhtmlgoodies_mainContainer ul{
      list-style-type:none; margin:0; padding:6px;
      min-height: 140px;
      background:#fff;
      border: 2px solid #667b68;
      border-radius: 10px;
    }

    /* ===== Draggable items ===== */
    ul li{
      margin: 3px 0;
      padding: 6px 8px;
      background-color: #ffffff;
      border: 1px solid #c8d1c8;
      border-radius: 6px;
      cursor: move;
      user-select: none;
    }
    ul li.correctAnswer{ background-color:#c9e4ca; }  /* pale green */
    ul li.wrongAnswer{   background-color:#f7caca; }  /* light rose */

    /* Destination highlight */
    .mouseover{
      box-shadow: 0 0 0 3px rgba(102,123,104,0.25) inset;
      border-radius: 10px;
    }

    /* Drag content & indicator */
    #dragContent{
      position:absolute; z-index:1000; list-style-type:none; margin:0; padding:0;
    }
    #dragContent li{
      list-style-type:none; margin:0; padding:6px 8px;
      background:#fff; border:1px solid #c8d1c8; border-radius:6px;
    }
    #dragDropIndicator{
      position:absolute; z-index:999;
    }

    /* Optional: save output */
    #saveContent{ width:900px; margin: 0 auto 40px; color:#333; }
  </style>

  <script type="text/javascript">
  /* ====== Adjustable settings ====== */
  var boxSizeArray = [3,3,3,3];   // Four family boxes; 3 items each (12 instruments total)

  var arrow_offsetX = -5;
  var arrow_offsetY = 0;
  var arrow_offsetX_firefox = -6;
  var arrow_offsetY_firefox = -13;

  var verticalSpaceBetweenListItems = 3;
  var initShuffleItems = true;
  var indicateDestionationByUseOfArrow = true;
  var lockedAfterDrag = false;
  /* ====== End settings ====== */

  var dragDropTopContainer = false;
  var dragTimer = -1;
  var dragContentObj = false;
  var contentToBeDragged = false;
  var contentToBeDragged_src = false;
  var contentToBeDragged_next = false;
  var destinationObj = false;
  var dragDropIndicator = false;
  var ulPositionArray = new Array();
  var mouseoverObj = false;

  var MSIE = navigator.userAgent.indexOf('MSIE')>=0?true:false;
  var navigatorVersion = navigator.appVersion.replace(/.*?MSIE (\d\.\d).*/g,'$1')/1;
  var destinationBoxes = new Array();
  var indicateDestinationBox = false;

  function getTopPos(inputObj){
    var returnValue = inputObj.offsetTop;
    while((inputObj = inputObj.offsetParent) != null){
      if(inputObj.tagName!='HTML')returnValue += inputObj.offsetTop;
    }
    return returnValue;
  }
  function getLeftPos(inputObj){
    var returnValue = inputObj.offsetLeft;
    while((inputObj = inputObj.offsetParent) != null){
      if(inputObj.tagName!='HTML')returnValue += inputObj.offsetLeft;
    }
    return returnValue;
  }
  function cancelEvent(){ return false; }

  function initDrag(e){
    if(document.all)e = event;
    if(lockedAfterDrag && this.parentNode.id!='allItems')return;
    var st = Math.max(document.body.scrollTop,document.documentElement.scrollTop);
    var sl = Math.max(document.body.scrollLeft,document.documentElement.scrollLeft);
    dragTimer = 0;
    dragContentObj.style.left = e.clientX + sl + 'px';
    dragContentObj.style.top  = e.clientY + st + 'px';
    contentToBeDragged = this;
    contentToBeDragged_src = this.parentNode;
    contentToBeDragged_next = false;
    if(this.nextSibling){
      contentToBeDragged_next = this.nextSibling;
      if(!this.tagName && contentToBeDragged_next.nextSibling)contentToBeDragged_next = contentToBeDragged_next.nextSibling;
    }
    timerDrag();
    return false;
  }

  function everythingIsCorrect(){ alert('Great job! All instruments are in the correct families.'); }

  function timerDrag(){
    if(dragTimer>=0 && dragTimer<10){
      dragTimer++;
      setTimeout('timerDrag()',10);
      return;
    }
    if(dragTimer==10){
      dragContentObj.style.display='block';
      dragContentObj.appendChild(contentToBeDragged);
    }
  }

  function moveDragContent(e){
    if(dragTimer<10){
      if(contentToBeDragged){
        if(contentToBeDragged_next){
          contentToBeDragged_src.insertBefore(contentToBeDragged,contentToBeDragged_next);
        }else{
          contentToBeDragged_src.appendChild(contentToBeDragged);
        }
      }
      return;
    }
    if(document.all)e = event;
    var st = Math.max(document.body.scrollTop,document.documentElement.scrollTop);
    var sl = Math.max(document.body.scrollLeft,document.documentElement.scrollLeft);
    dragContentObj.style.left = e.clientX + sl + 'px';
    dragContentObj.style.top  = e.clientY + st + 'px';

    if(mouseoverObj)mouseoverObj.className='';
    destinationObj = false;
    dragDropIndicator.style.display='none';
    if(indicateDestinationBox)indicateDestinationBox.style.display='none';
    var x = e.clientX + sl;
    var y = e.clientY + st;
    var width = dragContentObj.offsetWidth;
    var height = dragContentObj.offsetHeight;

    var tmpOffsetX = (!document.all)?arrow_offsetX_firefox:arrow_offsetX;
    var tmpOffsetY = (!document.all)?arrow_offsetY_firefox:arrow_offsetY;

    for(var no=0;no<ulPositionArray.length;no++){
      var ul_leftPos = ulPositionArray[no]['left'];
      var ul_topPos  = ulPositionArray[no]['top'];
      var ul_height  = ulPositionArray[no]['height'];
      var ul_width   = ulPositionArray[no]['width'];

      if((x+width) > ul_leftPos && x<(ul_leftPos + ul_width) && (y+height)> ul_topPos && y<(ul_topPos + ul_height)){
        var noExisting = ulPositionArray[no]['obj'].getElementsByTagName('LI').length;
        if(indicateDestinationBox && indicateDestinationBox.parentNode==ulPositionArray[no]['obj'])noExisting--;
        if(noExisting<boxSizeArray[no-1] || no==0){
          dragDropIndicator.style.left = ul_leftPos + tmpOffsetX + 'px';
          var subLi = ulPositionArray[no]['obj'].getElementsByTagName('LI');
          for(var liIndex=0;liIndex<subLi.length;liIndex++){
            var tmpTop = getTopPos(subLi[liIndex]);
            if(!indicateDestionationByUseOfArrow){
              if(y<tmpTop){
                destinationObj = subLi[liIndex];
                indicateDestinationBox.style.display='block';
                subLi[liIndex].parentNode.insertBefore(indicateDestinationBox,subLi[liIndex]);
                break;
              }
            }else{
              if(y<tmpTop){
                destinationObj = subLi[liIndex];
                dragDropIndicator.style.top = tmpTop + tmpOffsetY - Math.round(dragDropIndicator.clientHeight/2) + 'px';
                dragDropIndicator.style.display='block';
                break;
              }
            }
          }
          if(!indicateDestionationByUseOfArrow){
            if(indicateDestinationBox.style.display=='none'){
              indicateDestinationBox.style.display='block';
              ulPositionArray[no]['obj'].appendChild(indicateDestinationBox);
            }
          }else{
            if(subLi.length>0 && dragDropIndicator.style.display=='none'){
              dragDropIndicator.style.top = getTopPos(subLi[subLi.length-1]) + subLi[subLi.length-1].offsetHeight + tmpOffsetY + 'px';
              dragDropIndicator.style.display='block';
            }
            if(subLi.length==0){
              dragDropIndicator.style.top = ul_topPos + arrow_offsetY + 'px';
              dragDropIndicator.style.display='block';
            }
          }
          if(!destinationObj)destinationObj = ulPositionArray[no]['obj'];
          mouseoverObj = ulPositionArray[no]['obj'].parentNode;
          mouseoverObj.className='mouseover';
          return;
        }
      }
    }
  }

  function checkAnswers(){
    for(var no=0;no<destinationBoxes.length;no++){
      var subLis = destinationBoxes[no].getElementsByTagName('LI');
      if(subLis.length<boxSizeArray[no])return;
      for(var no2=0;no2<subLis.length;no2++){
        if(subLis[no2].className=='wrongAnswer')return;
      }
    }
    everythingIsCorrect();
  }

  function dragDropEnd(e){
    if(dragTimer==-1)return;
    if(dragTimer<10){ dragTimer = -1; return; }
    dragTimer = -1;
    if(document.all)e = event;
    if(destinationObj){
      var groupId = contentToBeDragged.getAttribute('groupId');
      if(!groupId)groupId = contentToBeDragged.groupId;

      var destinationToCheckOn = destinationObj;
      if(destinationObj.tagName!='UL'){ destinationToCheckOn = destinationObj.parentNode; }

      var answerCheck = false;
      if(groupId == destinationToCheckOn.id){
        contentToBeDragged.className = 'correctAnswer';
        answerCheck=true;
      }else{
        contentToBeDragged.className = 'wrongAnswer';
      }
      if(destinationObj.id=='allItems' || destinationObj.parentNode.id=='allItems')contentToBeDragged.className='';

      if(destinationObj.tagName=='UL'){
        destinationObj.appendChild(contentToBeDragged);
      }else{
        destinationObj.parentNode.insertBefore(contentToBeDragged,destinationObj);
      }
      mouseoverObj.className='';
      destinationObj = false;
      dragDropIndicator.style.display='none';
      if(indicateDestinationBox){
        indicateDestinationBox.style.display='none';
        document.body.appendChild(indicateDestinationBox);
      }
      contentToBeDragged = false;
      if(answerCheck)checkAnswers();
      return;
    }
    if(contentToBeDragged_next){
      contentToBeDragged_src.insertBefore(contentToBeDragged,contentToBeDragged_next);
    }else{
      contentToBeDragged_src.appendChild(contentToBeDragged);
    }
    contentToBeDragged = false;
    dragDropIndicator.style.display='none';
    if(indicateDestinationBox){
      indicateDestinationBox.style.display='none';
      document.body.appendChild(indicateDestinationBox);
    }
    mouseoverObj = false;
  }

  function saveDragDropNodes(){
    var saveString = "";
    var uls = dragDropTopContainer.getElementsByTagName('UL');
    for(var no=0;no<uls.length;no++){
      var lis = uls[no].getElementsByTagName('LI');
      for(var no2=0;no2<lis.length;no2++){
        if(saveString.length>0)saveString = saveString + ";";
        saveString = saveString + uls[no].id + '|' + lis[no2].id;
      }
    }
    document.getElementById('saveContent').innerHTML =
      '<h1>Ready to save these nodes:</h1> ' + saveString.replace(/;/g,';<br>') +
      '<p>Format: ID of ul | ID of li; (semicolon separated)</p>';
  }

  function initDragDropScript(){
    dragContentObj    = document.getElementById('dragContent');
    dragDropIndicator = document.getElementById('dragDropIndicator');
    dragDropTopContainer = document.getElementById('dhtmlgoodies_dragDropContainer');
    document.documentElement.onselectstart = cancelEvent;

    var listItems = dragDropTopContainer.getElementsByTagName('LI');
    var itemHeight = false;
    for(var no=0;no<listItems.length;no++){
      listItems[no].onmousedown = initDrag;
      listItems[no].onselectstart = cancelEvent;
      if(!itemHeight)itemHeight = listItems[no].offsetHeight;
      if(MSIE && navigatorVersion/1<6){ listItems[no].style.cursor='hand'; }
    }

    var mainContainer = document.getElementById('dhtmlgoodies_mainContainer');
    var uls = mainContainer.getElementsByTagName('UL');
    itemHeight = itemHeight + verticalSpaceBetweenListItems;
    for(var no=0;no<uls.length;no++){
      uls[no].style.height = itemHeight * boxSizeArray[no] + 'px';
      destinationBoxes[destinationBoxes.length] = uls[no];
    }

    document.documentElement.onmousemove = moveDragContent;
    document.documentElement.onmouseup   = dragDropEnd;

    var ulArray = dragDropTopContainer.getElementsByTagName('UL');
    for(var no=0;no<ulArray.length;no++){
      ulPositionArray[no] = new Array();
      ulPositionArray[no]['left']   = getLeftPos(ulArray[no]);
      ulPositionArray[no]['top']    = getTopPos(ulArray[no]);
      ulPositionArray[no]['width']  = ulArray[no].offsetWidth;
      ulPositionArray[no]['height'] = ulArray[no].clientHeight;
      ulPositionArray[no]['obj']    = ulArray[no];
    }

    if(initShuffleItems){
      var allItemsObj = document.getElementById('allItems');
      var initItems = allItemsObj.getElementsByTagName('LI');
      for(var i=0;i<(initItems.length*10);i++){
        var itemIndex = Math.floor(Math.random()*initItems.length);
        allItemsObj.appendChild(initItems[itemIndex]);
      }
    }
    if(!indicateDestionationByUseOfArrow){
      indicateDestinationBox = document.createElement('LI');
      indicateDestinationBox.id = 'indicateDestination';
      indicateDestinationBox.style.display='none';
      document.body.appendChild(indicateDestinationBox);
    }
  }
  window.onload = initDragDropScript;
  </script>
</head>

<body>
  <h1>Orchestral Instrument Families</h1>
  <p class="instructions">Drag and drop each instrument into its correct family. Each box can contain only <span class="style1">3 items</span>.</p>

  <div id="dhtmlgoodies_dragDropContainer">
    <div id="topBar">
      <div style="padding-bottom:5px; width:100%; height:1px;"></div>
    </div>

    <!-- Left column: items -->
    <div id="dhtmlgoodies_listOfItems">
      <p>Instruments/Names</p>
      <ul id="allItems">
        <!-- Strings -> box1 -->
        <li id="node1"  groupid="box1">Violin</li>
        <li id="node2"  groupid="box1">Viola</li>
        <li id="node3"  groupid="box1">Cello</li>

        <!-- Woodwinds -> box2 -->
        <li id="node4"  groupid="box2">Flute</li>
        <li id="node5"  groupid="box2">Clarinet</li>
        <li id="node6"  groupid="box2">Oboe</li>

        <!-- Brass -> box3 -->
        <li id="node7"  groupid="box3">Trumpet</li>
        <li id="node8"  groupid="box3">Trombone</li>
        <li id="node9"  groupid="box3">French Horn</li>

        <!-- Percussion -> box4 -->
        <li id="node10" groupid="box4">Timpani</li>
        <li id="node11" groupid="box4">Snare Drum</li>
        <li id="node12" groupid="box4">Cymbals</li>
      </ul>
    </div>

    <!-- Right column: family boxes -->
    <div id="dhtmlgoodies_mainContainer">
      <div><p>Strings</p><ul id="box1"></ul></div>
      <div><p>Woodwinds</p><ul id="box2"></ul></div>
      <div><p>Brass</p><ul id="box3"></ul></div>
      <div><p>Percussion</p><ul id="box4"></ul></div>
    </div>
  </div>

  <ul id="dragContent" style="left:110px; top:329px; display:block;"></ul>
  <div id="dragDropIndicator" style="display:none; left:24px; top:333px;"><img src="insert.gif" alt=""></div>
  <div id="saveContent"></div>
</body>
</html>

